---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-gateway
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gateway
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: gateway
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-gwc
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gwc
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: gwc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-rest
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: rest
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: rest
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-wcs
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wcs
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wcs
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-webui
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: webui
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: webui
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-wfs
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wfs
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wfs
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/pdb.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: gs-cloud-jdbc-geoserver-wms
  labels:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wms
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wms
---
# Source: gs-cloud-jdbc/templates/secrets_db.yaml
apiVersion: v1
data:
  database: b2dzY2xvdWQ=
  hostname: MTcyLjE3LjAuMQ==
  username: dXNlcm5hbWU=
  password: cGFzc3dvcmQ=
  port: NTQzMg==
  schema: Y29uZmln

kind: Secret
type: Opaque
metadata:
  name: "gs-cloud-jdbc-db"
---
# Source: gs-cloud-jdbc/charts/geoservercloud/templates/config/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
metadata:
  name: gs-cloud-jdbc-geoservercloud-etc
  labels:
    app.kubernetes.io/component: "config"
data:
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-gateway
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gateway
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gateway
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-gwc
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gwc
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gwc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-rest
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: rest
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: rest
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-wcs
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wcs
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wcs
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-webui
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: webui
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: webui
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-wfs
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wfs
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wfs
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: gs-cloud-jdbc-geoserver-wms
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wms
    prometheus: "true"
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      protocol: TCP
      targetPort: http
  selector:
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wms
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-gateway
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gateway
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: gateway
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: gateway
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-gateway:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-gwc
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: gwc
spec:
  replicas: 2
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: gwc
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: gwc
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-gwc:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-rest
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: rest
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: rest
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: rest
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-rest:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-wcs
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wcs
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wcs
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: wcs
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-wcs:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-webui
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: webui
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: webui
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: webui
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-webui:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-wfs
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wfs
spec:
  replicas: 2
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wfs
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: wfs
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-wfs:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gs-cloud-jdbc-geoserver-wms
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: wms
spec:
  replicas: 2
  revisionHistoryLimit: 3
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/name: geoserver
      app.kubernetes.io/instance: gs-cloud-jdbc
      app.kubernetes.io/component: wms
  template:
    metadata:
      labels:
        app.kubernetes.io/name: geoserver
        app.kubernetes.io/instance: gs-cloud-jdbc
        app.kubernetes.io/component: wms
    spec:
      serviceAccountName: default
      securityContext:
        {}
      affinity:
        null
      containers:
        - name: spring
          securityContext:
            {}
          image: "geoservercloud/geoserver-cloud-wms:1.0-RC31"
          imagePullPolicy: IfNotPresent
          env:
            - name: "GEOSERVER_BASE_PATH"
              value: /geoserver-cloud
            - name: "GEOTOOLS_HTTPCLIENT_PROXY_ENABLED"
              value: "false"
            - name: "GEOWEBCACHE_CACHE_DIR"
              value: /mnt/cache
            - name: "GWC_ENABLED"
              value: "true"
            - name: "JAVA_OPTS"
              value: -Dspring.config.additional-location=optional:file:/custom/geodata/jndi.yml
            - name: "JDBCCONFIG_DATABASE"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "database"
            - name: "JDBCCONFIG_HOST"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "hostname"
            - name: "JDBCCONFIG_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "password"
            - name: "JDBCCONFIG_PORT"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "port"
            - name: "JDBCCONFIG_SCHEMA"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "schema"
            - name: "JDBCCONFIG_USERNAME"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-jdbc-db"
                  key: "username"
            - name: "RABBITMQ_HOST"
              value: gs-cloud-common-rabbitmq
            - name: "RABBITMQ_PASSWORD"
              valueFrom:
                secretKeyRef:
                  name: "gs-cloud-common-rabbitmq"
                  key: "rabbitmq-password"
            - name: "RABBITMQ_USER"
              value: geoserver
            - name: "SPRING_PROFILES_ACTIVE"
              value: standalone,jdbcconfig
          terminationMessagePolicy: FallbackToLogsOnError
          resources:
            limits:
              cpu: 4
              memory: 4Gi
            requests:
              cpu: 0.1
              memory: 512Mi
          volumeMounts:
            - mountPath: /custom/geodata
              name: geodata
              readOnly: true
            - mountPath: /etc/gscloud
              name: vol-etc-gscloud
            - mountPath: /mnt/cache
              name: cache

          ports:
            - name: health
              containerPort: 8081
              hostIP: 127.0.0.1
            - name: http
              containerPort: 8080
              hostIP: 127.0.0.1

      volumes:
        - name: cache
          persistentVolumeClaim:
            claimName: gs-cloud-gwc-cache-nfs-claim
        - name: geodata
          configMap:
            name: cm-jndi-geodata
        - name: vol-etc-gscloud
          configMap:
            name: gs-cloud-jdbc-etc
---
# Source: gs-cloud-jdbc/charts/geoservercloud/charts/geoserver/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: gs-cloud-jdbc-geoserver-host1
  labels:
    helm.sh/chart: geoserver
    app.kubernetes.io/version: "1.0"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: geoserver
    app.kubernetes.io/instance: gs-cloud-jdbc
    app.kubernetes.io/component: main
spec:
# Add tls only if ingress.tls.enabled is set to true and the other fields are complete.
  rules:
    - host: "gscloud.local"
      http:
        paths:
          - path: "/geoserver-cloud/"
            pathType: Prefix
            backend:
              service:
                name: gs-cloud-jdbc-geoserver-gateway
                port:
                  number: 8080
---
# Source: gs-cloud-jdbc/templates/secrets_db.yaml
# NB: this suppose that a postgresql container is running
# on the host and that its gateway is 172.17.0.1
